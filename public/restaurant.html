<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="asset/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="asset/favicon.ico" type="image/x-icon" />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
    <script src="https://kit.fontawesome.com/fdc798ee43.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="styles/restaurant.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <title>Table Hopper</title>
</head>


<body onload="loadRestaurantInfo()">
    <nav class="navbar navbar-expand-lg navbar-light">
        <a class="navbar-brand tablehopper ml-2" href="index.html" style="color: #006AFF;">Table Hopper</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-list" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg" style="color: white;">
                    <path fill-rule="evenodd"
                        d="M2.5 11.5A.5.5 0 0 1 3 11h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 3h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
                </svg>
            </button>

        <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
            <ul class="nav">
                <!-- <li class="nav-item active">
                        <a class="nav-link">About Us<span
                                class="sr-only">(current)</span></a>
                    </li>-->
                <li class="nav-item">
                    <a class="nav-link" href="login.html" style="color: #006AFF;">Log In</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="register.html" style="background-color: #006AFF;border-radius: 5px;">Sign Up</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="col-sm-6 restaurant">

    </div>


</body>


<script>
    function loadRestaurantInfo() {
        checkLogInStatus()
        const urlParams = new URLSearchParams(window.location.search);
        const myParam = urlParams.get('id');
        var request = new XMLHttpRequest();
        console.log(request)
        request.open("GET", `restaurants/id/${myParam}`, true);
        request.setRequestHeader("Content-Type", "application/json");
        request.onload = function() {
            response = JSON.parse(request.responseText);
            reviewArrayLength = response[0].reviewArray.length

            let reviewStr = ""
            for (var i = 0; i < reviewArrayLength; i++) {
                reviewStr += `
                <div class="reviewSection">
                    <img id="userImage" src="asset/wallpaper.png">
                    <span id="userName">${response[0].reviewArray[i].reviewUserId}</span>

                    <div id='commentSection'>
                        <p id="commentDate">Written at: <span id="writtenAtDate">${response[0].reviewArray[i].reviewDate}</span></p>
                        <p class="commentRating">${response[0].reviewArray[i].reviewRating}</p>
                        <p id="commentSectionText">${response[0].reviewArray[i].reviewContent}</p>
                    </div>
                </div>`
            }

            let str = ""
            for (var i = 0; i < response.length; i++) {
                str += `
        <h3 id="restaurantName">${response[i].restaurantName}</h3>
        <h5 id="restaurantCategory">${response[i].restaurantCategory}</h5>
        <h5 id="restaurantAddress"><i class="fas fa-map-marker-alt" style="padding-right: 5px"></i>${response[i].restaurantAddress}</h5>

        <img src="asset/restaurantGallery/${response[i].restaurantGallery}" id="restaurantImage">

        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'restaurant-about')" id="defaultOpen">Overview</button>
            <button class="tablinks" onclick="openTab(event, 'restaurant-review')" >Review</button>
        </div>
        <div id="restaurant-about" class="tabcontent">
            <h5 id="restaurant-about-text"><i class="fas fa-info-circle" style="font-size: 18px;margin-right: 5px;"></i> About the restaurant</h5>
            <div class="h_line"></div>
            <h5 id="restaurantAbout">${response[i].restaurantAbout}</h5>

            <div class="review-features" style="margin-bottom: 5vh">
                <h5 id="restaurant-about-text"><i class="fas fa-question-circle" style="font-size: 18px;margin-right: 5px;"></i> Features and Pricing</h5>
                <div class="h_line"></div>
                <div id="restaurantStar">
                    <div class="stars-outer">
                        <div class="stars-inner">${response[i].restaurantRating}</div>
                    </div>
                </div>
                <h5 id="restaurantFeatures"><i class="fas fa-check-circle" style="color: limegreen"></i> ${response[i].restaurantFeatures[0]}</h5>
                <h5 id="restaurantFeatures"><i class="fas fa-check-circle" style="color: limegreen"></i> ${response[i].restaurantFeatures[1]}</h5>
                <h5 id="restaurantPricing"><i class="far fa-money-bill-alt" style="color: green"></i> ${response[i].restaurantPricing}</h5>
            </div>

            <div class="opening-Hour" style="margin-bottom: 5vh">
                <h5 id="restaurant-about-text"><i class="fas fa-clock" style="font-size: 18px;margin-right: 5px;"></i> Opening Hours</h5>
                <div class="h_line"></div>
                <p style="font-family: prodmed;">${response[i].restaurantOpeningHours}</p>
            </div>

            <div class="contact" style="margin-bottom: 5vh">
                <h5 id="restaurant-about-text"><i class="fas fa-mobile-alt" style="font-size: 18px;margin-right: 5px;"></i> Contact Us</h5>
                <div class="h_line"></div>
                <ul>
                    <li id="contact-phone" style="font-family: prodmed;margin-top: 5px;">${response[i].restaurantPhone}</li>
                    <li id="contact-email" style="font-family: prodmed;">${response[i].restaurantEmail}</li>
                    <li id="contact-socialMedia" style="font-family: prodmed;">${response[i].restaurantSocialMedia}</li>
                </ul>
            </div>
            <div class="website" style="margin-bottom: 5vh">
                <h5 id="restaurant-about-text"><i class="fas fa-laptop" style="font-size: 18px;margin-right: 5px;"></i> Find Us at</h5>
                <div class="h_line"></div>
                <a href="https://www.google.com" id="website-link" style="font-family: prodmed;margin-top: 5px;">${response[i].restaurantLink}</a>
            </div>
        </div>



        
        <div id="restaurant-review" class="tabcontent">
            <div class="addReview">
                    <input id="addReviewBox" type="text" placeholder="  Write your review here">
                    <button id="addReviewButton"><i class="fas fa-plus-circle"></i></button>
            </div>
            <div class="reviewBox">

            </div>
        </div>
        `
            }
            document.getElementsByClassName('col-sm-6 restaurant')[0].innerHTML = str
            document.getElementsByClassName('reviewBox')[0].innerHTML = reviewStr
            document.getElementById("defaultOpen").click();
            displayStar()
            displayReviewStar()
        }
        request.send()
    }

    function displayStar() {
        var starCount = document.getElementsByClassName('stars-inner')
        const maxStar = 5
        for (let i = 0; i < starCount.length; i++) {
            var star = parseInt(starCount[i].innerHTML)
            var starUnchecked = maxStar - star
            starCount[i].innerHTML = `<span class="fa fa-star"></span>`.repeat(star) + `<span class="fa fa-star" style="opacity: 50%"></span>`.repeat(starUnchecked)
        }
    }

    function displayReviewStar() {
        var count = document.getElementsByClassName('commentRating')
        const maxStar = 5
        for (let i = 0; i < count.length; i++) {
            var star = count[i].innerHTML
            var starUnchecked = maxStar - star
            count[i].innerHTML = `<span class="fa fa-star"></span>`.repeat(star) + `<span class="fa fa-star" style="opacity: 50%"></span>`.repeat(starUnchecked)
        }
        // console.log(starCount.length)
    }

    function checkLogInStatus() {
        value_or_null = (document.cookie.match(/^(?:.*;)?\s*username\s*=\s*([^;]+)(?:.*)?$/) || [, null])[1]
        console.log("Logged in as", value_or_null)
        if (value_or_null != "") { //!= to see is user is logged in, if logged in, hide the login and signup button
            document.getElementsByClassName('nav')[0].style.visibility = "hidden";
            document.getElementsByClassName('navbar-toggler')[0].style.visibility = "hidden";
        }
    }

    function openTab(evt, tabname) {
        var tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "";
            console.log(tabcontent[i])
        }

        // Get all elements with class="tablinks" and remove the class "active"
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace("active", "");
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(tabname).style.display = "block";
        evt.currentTarget.className += "active";
    }
</script>

</html>